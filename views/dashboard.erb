<%# provide(:title, 'Dashboard') %>
<h1>Dashboard!</h1>
<!-- INTERFACE DOWN WARNINGS -->
<% if !ints_down.empty? %>
  <div class='row'>
    <div class='col-md-2'></div>
    <div class='col-md-8'>
      <ul class='list-group'>
        <% ints_down.each do |device,data| %>
          <% data[:interfaces].each do |if_index,oids| %>
            <li class='center list-group-item list-group-item-danger'>
            <%= device_link(oids) + ' PORT ' + interface_link(settings, oids) %> 
            TO <%= neighbor_link(oids) %> is <b>DOWN!</b>
            <span class='badge' style='float: left;'>&nbsp;
              <span class='glyphicon glyphicon-warning-sign'></span>
              Link Down&nbsp;&nbsp;
            </span>
            <span class='badge'>
              <%= humanize_time(Time.now.to_i - oids[:if_oper_status_time]) %>
            </span>
            </li>
          <% end %>
        <% end %>
      </ul>
    </div>
    <div class='col-md-2'></div>
  </div>
<% end %>

<div class='row'>

  <!-- HIGH CPU USAGE -->
  <div class='col-md-6'>
    <% if !cpus_high.empty? %>
      <h2>High CPU Usage</h2>
    <table id='highCpuTable' class='table table-hover table-condensed tablesorter'>
      <thead>
        <tr>
          <th>Device</th>
          <th>CPU Description </th>
          <th>Utilization </th>
        </tr>
      </thead>
      <tbody>
      <% cpus_high.each do |device,data| %>
        <% data[:cpus].each do |cpu_index,data| %>
        <tr>
        <td><%= device_link(data) %></td>
        <td><%= data[:description] %></td>
        <td>
          <span class='text-danger'><b><%= data[:util] %>%</b></span>
        </td>
      </tr>
    <% end %>
    <% end %>
      </tbody>
    </table>
  <% end %>

  <br />

  <!-- DISCARDING PORTS -->
    <h2>Top Discarding Ports</h2>
    <% if !ints_discarding.empty? %>
      <table id='discardTable' class='table table-hover table-condensed tablesorter'>
      <thead>
        <tr>
          <th class='pxl-hidden'>Total</th>
          <th>Discards/sec </th>
          <th>Device</th>
          <th>Interface </th>
          <th>Neighbor </th>
          <th>Ingress </th>
          <th>Egress </th>
        </tr>
      </thead>
      <tbody>
      <% ints_discarding.each do |device,data| %>
        <% data[:interfaces].each do |if_index,oids| %>
          <tr <%= tr_attributes(oids) %>>
            <td class='pxl-hidden'><%= oids[:discards_out] %></td>
            <td>
              <span class='text-danger'><b><%= oids[:discards_out] %></b></span>
              <%= "(#{oids[:discards_out_pct]}%)" %>
            </td>
            <td><%= device_link(oids) %></td>
            <td><%= interface_link(settings, oids) %></td>
            <td><%= neighbor_link(oids, { device_only: true }) %></td>
            <td class='pxl-histogram pxl-meta <%= 'pxl-hoverswap' unless /^10+/.match(oids[:if_high_speed].to_s) %>' data-pxl-meta='<%= oids[:bps_in_util]%>'>
              <span class='pxl-swap-pri'>
                <%= bps_cell('in', oids, { compact: true, bps_only: true }) %>
              </span>
              <span class='pxl-swap-alt'>
                <%= bps_cell('in', oids, { pct_only: true }) %>
              </span>
            </td>
            <td class='pxl-histogram pxl-meta <%= 'pxl-hoverswap' unless /^10+/.match(oids[:if_high_speed].to_s) %>' data-pxl-meta='<%= oids[:bps_out_util]%>'>
              <span class='pxl-swap-pri'>
                <%= bps_cell('out', oids, { compact: true, bps_only: true }) %>
              </span>
              <span class='pxl-swap-alt'>
                <%= bps_cell('out', oids, { pct_only: true }) %>
              </span>
            </td>
          </tr>
        <% end %>
      <% end %>
      </tbody>
      </table>
    <% end %>
  </div>

  <!-- SATURATED PORTS -->
  <div class='col-md-6'>
    <h2>Saturated Links</h2>
    <% if !ints_saturated.empty? %>
      <table id='discardTable' class='table table-hover table-condensed tablesorter'>
      <thead>
        <tr>
          <th class='pxl-hidden'>Total</th>
          <th class='pxl-th'>Device</th>
          <th class='pxl-th'>Interface </th>
          <th class='pxl-th'>Type </th>
          <th class='pxl-th'>Neighbor </th>
          <th class='pxl-th'>Ingress </th>
          <th class='pxl-th'>Egress </th>
        </tr>
      </thead>
      <tbody>
      <% ints_saturated.each do |device,data| %>
        <% data[:interfaces].each do |if_index,oids| %>
          <tr <%= tr_attributes(oids) %>>
            <td class='pxl-hidden'><%= oids[:discards_out] %></td>
            <td><%= device_link(oids) %></td>
            <td><%= interface_link(settings, oids) %></td>
            <td><%= oids[:link_type] %>
              <% if oids[:is_child] %>
                <span> <%= "[#{oids[:my_parent_name]}]" %></span>
              <% end %>
            </td>
            <td><%= neighbor_link(oids, { device_only: true }) %></td>
            <td class='pxl-histogram pxl-meta <%= 'pxl-hoverswap' unless /^10+/.match(oids[:if_high_speed].to_s) %>' data-pxl-meta='<%= oids[:bps_in_util]%>'>
              <span class='pxl-swap-pri'>
                <%= bps_cell('in', oids, { compact: true, bps_only: true }) %>
              </span>
              <span class='pxl-swap-alt'>
                <%= bps_cell('in', oids, { pct_only: true }) %>
              </span>
            </td>
            <td class='pxl-histogram pxl-meta <%= 'pxl-hoverswap' unless /^10+/.match(oids[:if_high_speed].to_s) %>' data-pxl-meta='<%= oids[:bps_out_util]%>'>
              <span class='pxl-swap-pri'>
                <%= bps_cell('out', oids, { compact: true, bps_only: true }) %>
              </span>
              <span class='pxl-swap-alt'>
                <%= bps_cell('out', oids, { pct_only: true }) %>
              </span>
            </td>
          </tr>
        <% end %>
      <% end %>
      </tbody>
      </table>
    <% end %>
  </div>

</div>
